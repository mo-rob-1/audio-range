<div x-cloak x-data="{ mobileMenuOpen: false, searchBarOpen: false }" class="image-background">
    <div>
        <div class="header__wrapper">
          <div class="header__nav--mobile">
            <!-- STORE NAME / STORE LOGO -->
              <button class="header__hamburger-btn" type="button" x-on:click="mobileMenuOpen = true">
                  {% render 'icon-hamburger' %}
              </button>
  
              <a class="header__site-name" href="{{ shop.url }}">{{ shop.name }}</a>
  
              <!-- Link to open the modal -->
              <a class="header__cart-icon" href="#ex1" rel="modal:open">
                  {% render 'icon-shopping-cart' %}
              </a>
          </div>
  
            <!-- NAVIGATION MENU -->
            <nav class="header__nav header__nav--desktop">
              <ul class="header__nav-list">
                  {% for link in section.settings.menu.links %}
                      {% if link.links != blank %}
                          {% assign link_handle = link.handle | replace: '-', '_' %}
                          <div x-data="{ {{link_handle}}: false }">
                              <button x-on:click="{{link_handle}} = ! {{link_handle}}">
                                  {{ link.title }}
                                  {% render 'icon-dropdown' %}
                              </button>
  
                              <div @click.away="{{link_handle}} = false" x-show="{{link_handle}}" x-transition:enter-end="opacity-100 translate-y-0" x-transition:enter-start="opacity-0 translate-y-3" x-transition:enter="transition ease-out duration-300" x-transition:leave-end="opacity-0 translate-y-3" x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave="transition ease-out duration-300">
                                  {% for childlink in link.links  %}
                                      <li class="header__nav-list-item">
                                          <a class="header__nav-link" href="{{childlink.url}}">{{childlink.title}}</a>
                                      </li>
                                  {% endfor %}
                              </div>
                          </div>
                      {% else %}
                      <li class="header__nav-list-item">
                          <a class="header__nav-link" href="{{ link.url }}">
                              {{ link.title }}
                          </a>
                      </li>
                      {% endif %}
                  {% endfor %}
              </ul>
            </nav>
  
            <!-- CART BUTTON / ACCOUNT LINKS IF ENABLED -->
            <div>
                {%- comment -%} <button type="button" x-on:click="searchBarOpen = true">
                    {% render 'icon-search' %}
                </button> {%- endcomment -%}
  
                {%- comment -%} <a href="{{ routes.cart_url }}">
                    {% render 'icon-shopping-cart' %}
                    {% if cart.item_count > 0 %}
                        <span>{{ cart.item_count }}</span>
                    {% endif %}
                </a> {%- endcomment -%}
  
              <div id="ex1" class="modal">
                  {% if cart.item_count > 0 %}
                      <div>
                          <div>
                              <div>
                                  <h3>Cart ({{ cart.item_count }})</h3>   
                              </div>
                          </div>
  
                          <button onclick="clearCart();">Clear cart</button>
  
  
                          <form class="header__cart-form" action="{{ routes.cart_url }}" method="POST" novalidate>
                              <div>
                                  <div>
                                      {% for item in cart.items %}
                                          <div>
                                              <div>
                                                  <a href="{{ item.url }}">
                                                      {% if item.image %}
                                                              <img src="{{ item.image | img_url: 'small'}}" alt="{{ item.title | escape }}">
                                                      {% else %}
                                                              {{ 'product-1' | placeholder_svg_tag: 'h-20 w-20 object-cover border' }}
                                                      {% endif %}
                                                  </a>
                                              </div>
                                              <div>
                                                  <a href="{{ item.url }}">{{ item.product.title | truncatewords: 5 }}</a>
                                              </div>
                                              <div>
                                                  {{ item.line_price | money }}
                                              </div>
                                              <div>
                                                  <input name="updates[]" value="{{ item.quantity }}" min="1" type="number" id="updates_{{ forloop.index }}">
                                              </div>
                                          </div>
                                      {% endfor %}
                                  </div>
                              </div>
                          </form>
  
                          <div>
                              <h3>Total</h3>
                              <h3>{{ cart.total_price | money }}</h3>
                          </div>
  
                          <div>
                              <button name="checkout" type="submit">Checkout</button>
                          </div>
                      </div>
                    
                    {% else %}
                      <div>
                          <h1>Your cart is empty</h1>
                          <a href="{{ routes.all_products_collection_url }}">Continue shopping</a>
                      </div>
                    {% endif %}
              </div>
  
              {% if shop.customer_accounts_enabled %}
                    {% if customer %}
                        <a class="header__customer-account-link" href="{{ routes.account_url }}">Account</a>
                        {{ 'Logout' | customer_logout_link | replace: '<a', '<a' }}
                    {% else %}
                        {{ 'Login' | customer_login_link | replace: '<a', '<a' }}
                        {{ 'Register' | customer_register_link | replace: '<a', '<a' }}
                    {% endif %}
              {% endif %}
            </div>
  
            <!-- MOBILE MENU CONTAINER -->
            <div x-show="mobileMenuOpen">
                <div>
                    <div>
                        <!-- MOBILE MENU HEADER TITLE PLUS CLOSE BUTTON -->
                        <div>
                            <div>
                                <button type="button" x-on:click="mobileMenuOpen = false">
                                    {% render 'icon-close' %}
                                </button>
                            </div>
                        </div>
  
                        <!-- NAVIGATION LINKS FOR MOBILE MENU -->
                        <div>
                            <nav class="header__nav">
                              <ul class="header__nav-list">
                                {% for link in section.settings.menu.links %}
                                    {% if link.links != blank %}
                                        {% assign mobile_link_handle = link.handle | replace: "-", "_"  %}
                                        <div x-data="{ {{mobile_link_handle}}: false }">
                                            <button type="button" x-on:click="{{ mobile_link_handle }} = ! {{ mobile_link_handle }}">
                                                {{ link.title }}
                                                {% render 'icon-dropdown' %}
                                            </button>
  
                                            <div x-show="{{ mobile_link_handle }}">
                                                {% for childlink in link.links  %}
                                                  <li class="header__nav-list-item">
                                                    <a href="{{childlink.url}}">
                                                      {{childlink.title}}
                                                    </a>
                                                  </li>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% else %}
                                      <li>
                                        <a href="{{ link.url }}">
                                          {{ link.title }}
                                        </a>
                                      </li>
                                    {% endif %}
                                {% endfor %}
                              </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  
    {%- comment -%} <div x-show="searchBarOpen">
        <button type="button" x-on:click="searchBarOpen = false">
            {% render 'icon-close' %}
        </button>
        <div>
            <form action="{{ routes.search_url }}" method="get">
                <div>
                    <input name="q" placeholder="Search" type="search">
                    <button type="submit">
                        {% render 'icon-search' %}
                    </button>
                </div>
            </form>
        </div>
    </div> {%- endcomment -%}
  
  </div>
  
  {% schema %}
  
  {
    "name": "Header",
    "settings": [
        {
            "type": "text",
            "id": "mobile_menu_title",
            "default": "Menu",
            "label": "Mobile Menu Title"
        }, {
            "type": "link_list",
            "id": "menu",
            "default": "main-menu",
            "label": "Heading Navigation Menu"
        }
    ]
  }
  
  {% endschema %}
  